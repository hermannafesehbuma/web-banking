# 📧 Supabase Email Verification Setup Guide

## 🎯 How to Add Custom Email Template to Supabase

### Step 1: Access Supabase Dashboard

1. Go to your Supabase project dashboard
2. Navigate to **Authentication** → **Email Templates**

---

### Step 2: Select Confirmation Template

1. Find **"Confirm signup"** in the list of email templates
2. Click to edit

---

### Step 3: Copy the Template

1. Open the file: `EMAIL_VERIFICATION_TEMPLATE.html`
2. Copy the entire HTML content
3. Paste it into the **"Email Body"** field in Supabase

---

### Step 4: Configure Template Variables

Supabase uses Go template syntax. The template includes:

**Available Variables:**

- `{{ .ConfirmationURL }}` - The verification link (automatically generated by Supabase)
- `{{ .Token }}` - The verification token
- `{{ .TokenHash }}` - The hashed token
- `{{ .SiteURL }}` - Your site URL from Supabase settings

**Our template uses:**

- `{{ .ConfirmationURL }}` - This is the main verification link

---

### Step 5: Update Email Subject

In the **"Subject"** field, enter:

```
Verify Your Email Address - Fortiz Bank
```

---

### Step 6: Configure Sender Details

1. Go to **Authentication** → **Settings**
2. Update **"Sender Email"** to: `contact@fortizb.com`
3. Update **"Sender Name"** to: `Fortiz Bank`

**Important:** Make sure `contact@fortizb.com` is verified in your email service provider (Supabase uses their own SMTP by default, or you can configure custom SMTP).

---

### Step 7: Test the Email

1. Save your changes
2. Try signing up with a new email address
3. Check your inbox for the verification email
4. Verify the email displays correctly and the button works

---

## 🔧 Optional: Custom SMTP Configuration

If you want to use your own email service (like Resend) for Supabase auth emails:

### Using Custom SMTP:

1. Go to **Project Settings** → **Auth** → **SMTP Settings**
2. Enable **"Enable Custom SMTP"**
3. Configure:
   ```
   SMTP Host: smtp.resend.com
   SMTP Port: 587
   SMTP User: resend
   SMTP Password: [Your Resend API Key]
   Sender Email: contact@fortizb.com
   Sender Name: Fortiz Bank
   ```

---

## 📝 Template Features

### ✅ What's Included:

- **Professional Header**: Black gradient with Fortiz Bank branding
- **Email Icon**: Visual indicator for email verification
- **Clear Call-to-Action**: Large "VERIFY EMAIL ADDRESS" button
- **Alternative Link**: Fallback text link if button doesn't work
- **Security Notice**: Warning about link expiration (24 hours)
- **Next Steps**: What happens after verification (KYC, accounts, banking)
- **Contact Information**: Email and phone support
- **Footer Links**: Website, branches, contact page
- **Legal Disclaimer**: FDIC notice and copyright

### 🎨 Design:

- **Responsive**: Works on all devices
- **Accessible**: Screen reader friendly
- **Professional**: Matches your existing email templates
- **Branded**: Consistent Fortiz Bank styling (black/white theme)

---

## 🔐 Security Best Practices

1. **Link Expiration**: Template mentions 24-hour expiration (configure in Supabase Auth settings)
2. **Clear Warning**: Tells users to ignore if they didn't sign up
3. **No Sensitive Data**: Doesn't include password or personal info
4. **HTTPS Links**: Ensure your site URL uses HTTPS

---

## 🧪 Testing Checklist

Before going live, test:

- [ ] Email arrives in inbox (not spam)
- [ ] From address shows "Fortiz Bank <contact@fortizb.com>"
- [ ] Subject line is correct
- [ ] Button renders correctly
- [ ] Button link works and redirects to your site
- [ ] Alternative text link works
- [ ] Email displays correctly on mobile
- [ ] Email displays correctly in Gmail, Outlook, Apple Mail
- [ ] Unsubscribe/spam link works (if applicable)

---

## 📱 Preview on Different Clients

Test your email on:

- ✅ Gmail (web and mobile)
- ✅ Outlook (web and desktop)
- ✅ Apple Mail (macOS and iOS)
- ✅ Yahoo Mail
- ✅ ProtonMail

---

## 🔄 Supabase Auth Flow

### Complete User Journey:

1. **User Signs Up** → Supabase creates user with `email_confirmed_at: null`
2. **Email Sent** → Your custom template is sent to user
3. **User Clicks Link** → Redirected to your site with confirmation token
4. **Email Verified** → Supabase updates `email_confirmed_at` timestamp
5. **Redirect** → User is sent to dashboard or KYC page

### Configure Redirect URL:

1. Go to **Authentication** → **URL Configuration**
2. Set **"Site URL"** to: `https://www.fortizb.com`
3. Add **"Redirect URLs"**:
   - `https://www.fortizb.com/dashboard`
   - `https://www.fortizb.com/kyc`
   - `http://localhost:3000/dashboard` (for development)

---

## 🎯 Alternative Template Variables

If you want to customize further, here are other variables you can use:

```html
{{ .Email }} - User's email address {{ .ConfirmationURL }} - Verification link
{{ .Token }} - Raw token {{ .TokenHash }} - Hashed token {{ .SiteURL }} - Your
configured site URL {{ .RedirectTo }} - Custom redirect URL (if provided)
```

**Example:**

```html
<p>Hi {{ .Email }},</p>
<p>Click here to verify: {{ .ConfirmationURL }}</p>
```

---

## 📞 Support

If you encounter issues:

- Check Supabase logs: **Project** → **Logs** → **Auth Logs**
- Review email queue: **Authentication** → **Logs**
- Contact Supabase support: https://supabase.com/support

---

## ✅ Quick Setup Checklist

- [ ] Copy HTML template to Supabase
- [ ] Update email subject
- [ ] Configure sender email and name
- [ ] Set site URL and redirect URLs
- [ ] Test with real email address
- [ ] Verify link works correctly
- [ ] Check mobile responsiveness
- [ ] Test on multiple email clients
- [ ] Enable custom SMTP (optional)
- [ ] Go live!

---

**Template File:** `EMAIL_VERIFICATION_TEMPLATE.html`
**Last Updated:** October 2025
